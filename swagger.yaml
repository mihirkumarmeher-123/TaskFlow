openapi: 3.0.3
info:
  title: TaskFlow - Collaborative Project Management API
  version: 1.0.0
  description: |
    REST API backend for **TaskFlow**, a collaborative project management system.
    Supports authentication, projects, teams, tasks, dependencies, comments, file uploads, time tracking, and reporting.

servers:
  - url: http://localhost:5001/api
    description: Local development server

tags:
  - name: Authentication
  - name: Projects
  - name: Teams
  - name: Tasks
  - name: Comments
  - name: Files
  - name: Reports

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    User:
      type: object
      properties:
        id: { type: integer }
        name: { type: string }
        email: { type: string }
        role:
          type: string
          enum: [admin, manager, member]

    Project:
      type: object
      properties:
        id: { type: integer }
        name: { type: string }
        description: { type: string }
        status:
          type: string
          enum: [planning, active, completed, archived]
        startDate: { type: string, format: date }
        endDate: { type: string, format: date }

    Team:
      type: object
      properties:
        id: { type: integer }
        projectId: { type: integer }
        name: { type: string }
        description: { type: string }

    Task:
      type: object
      properties:
        id: { type: integer }
        projectId: { type: integer }
        title: { type: string }
        description: { type: string }
        assigneeId: { type: integer }
        priority:
          type: string
          enum: [low, medium, high, critical]
        status:
          type: string
          enum: [todo, in_progress, in_review, done, blocked]
        dueDate: { type: string, format: date }
        estimateHours: { type: number }

    Comment:
      type: object
      properties:
        id: { type: integer }
        taskId: { type: integer }
        userId: { type: integer }
        content: { type: string }

    Attachment:
      type: object
      properties:
        id: { type: integer }
        filename: { type: string }
        originalName: { type: string }
        taskId: { type: integer }
        projectId: { type: integer }
        uploadedBy: { type: integer }

security:
  - bearerAuth: []

paths:

  /auth/register:
    post:
      tags: [Authentication]
      summary: Register a new user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              properties:
                name: { type: string }
                email: { type: string }
                password: { type: string }
                role:
                  type: string
                  enum: [admin, manager, member]
      responses:
        "201": { description: User registered successfully }
        "400": { description: Invalid or existing user }

  /auth/login:
    post:
      tags: [Authentication]
      summary: Login and get JWT token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              properties:
                email: { type: string }
                password: { type: string }
      responses:
        "200": { description: Login successful, token returned }
        "401": { description: Invalid credentials }

  /projects:
    get:
      tags: [Projects]
      summary: Get all projects
      security: [{ bearerAuth: [] }]
      parameters:
        - name: page
          in: query
          schema: { type: integer, default: 1 }
        - name: limit
          in: query
          schema: { type: integer, default: 20 }
      responses:
        "200": { description: Project list }
    post:
      tags: [Projects]
      summary: Create new project (admin/manager)
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              properties:
                name: { type: string }
                description: { type: string }
                startDate: { type: string, format: date }
                endDate: { type: string, format: date }
      responses:
        "201": { description: Project created }

  /projects/{id}:
    get:
      tags: [Projects]
      summary: Get project details with teams and tasks
      security: [{ bearerAuth: [] }]
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: integer }
      responses:
        "200": { description: Project details }
    put:
      tags: [Projects]
      summary: Update project info (admin/manager)
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              properties:
                name: { type: string }
                description: { type: string }
                status: { type: string }
      responses:
        "200": { description: Project updated }
    delete:
      tags: [Projects]
      summary: Delete project (admin only)
      security: [{ bearerAuth: [] }]
      responses:
        "200": { description: Project deleted }

  /teams:
    post:
      tags: [Teams]
      summary: Create a team (admin/manager)
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              properties:
                projectId: { type: integer }
                name: { type: string }
                description: { type: string }
      responses:
        "201": { description: Team created }

  /teams/members:
    post:
      tags: [Teams]
      summary: Add member to a team (admin/manager)
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              properties:
                teamId: { type: integer }
                userId: { type: integer }
                role:
                  type: string
                  enum: [lead, developer, tester, designer, other]
      responses:
        "201": { description: Member added }

  /teams/{teamId}/members:
    get:
      tags: [Teams]
      summary: Get all members of a team
      security: [{ bearerAuth: [] }]
      parameters:
        - name: teamId
          in: path
          required: true
          schema: { type: integer }
      responses:
        "200": { description: List of team members }

  /tasks:
    get:
      tags: [Tasks]
      summary: Get tasks (filter by project, assignee, status)
      security: [{ bearerAuth: [] }]
      parameters:
        - name: projectId
          in: query
          schema: { type: integer }
        - name: assigneeId
          in: query
          schema: { type: integer }
        - name: status
          in: query
          schema:
            type: string
            enum: [todo, in_progress, in_review, done, blocked]
        - name: search
          in: query
          schema: { type: string }
      responses:
        "200": { description: List of tasks }
    post:
      tags: [Tasks]
      summary: Create a task (manager/member)
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              properties:
                projectId: { type: integer }
                title: { type: string }
                description: { type: string }
                assigneeId: { type: integer }
                priority: { type: string }
                dueDate: { type: string, format: date }
                estimateHours: { type: number }
      responses:
        "201": { description: Task created }

  /tasks/{id}:
    get:
      tags: [Tasks]
      summary: Get task details (comments + time entries)
      security: [{ bearerAuth: [] }]
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: integer }
      responses:
        "200": { description: Task details }
    put:
      tags: [Tasks]
      summary: Update task info/status
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              properties:
                title: { type: string }
                description: { type: string }
                status: { type: string }
                priority: { type: string }
      responses:
        "200": { description: Task updated }
    delete:
      tags: [Tasks]
      summary: Delete a task (admin/manager)
      security: [{ bearerAuth: [] }]
      responses:
        "200": { description: Task deleted }

  /tasks/dependencies:
    post:
      tags: [Tasks]
      summary: Add dependency between tasks
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              properties:
                taskId: { type: integer }
                dependsOnTaskId: { type: integer }
      responses:
        "201": { description: Dependency added }

  /comments:
    post:
      tags: [Comments]
      summary: Add comment to task
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              properties:
                taskId: { type: integer }
                content: { type: string }
      responses:
        "201": { description: Comment created }

  /files/upload:
    post:
      tags: [Files]
      summary: Upload a file (multipart/form-data)
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
                projectId: { type: integer }
                taskId: { type: integer }
      responses:
        "201": { description: File uploaded }

  /files/download/{id}:
    get:
      tags: [Files]
      summary: Download uploaded file by ID
      security: [{ bearerAuth: [] }]
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: integer }
      responses:
        "200":
          description: File downloaded
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary

  /reports/{projectId}/tasks/summary:
    get:
      tags: [Reports]
      summary: Get task summary by project
      security: [{ bearerAuth: [] }]
      parameters:
        - name: projectId
          in: path
          required: true
          schema: { type: integer }
      responses:
        "200": { description: Task summary with counts }

  /reports/{projectId}/timeentries/csv:
    get:
      tags: [Reports]
      summary: Export project time entries as CSV
      security: [{ bearerAuth: [] }]
      parameters:
        - name: projectId
          in: path
          required: true
          schema: { type: integer }
      responses:
        "200":
          description: CSV file returned
          content:
            text/csv:
              schema:
                type: string
                format: binary
